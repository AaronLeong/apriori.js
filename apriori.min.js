"use strict";var Apriori;!function(a){var b=function(){function a(a,b){this.frequentItemSets=a,this.associationRules=b}return a}();a.AnalysisResult=b;var c=function(){function a(a,b){this.itemSet=a,this.support=b}return a}();a.FrequentItemSet=c;var d=function(){function a(a,b,c){this.lhs=a,this.rhs=b,this.confidence=c}return a}();a.AssociationRule=d;var e=function(){function d(a,b,c){this.minSupport=a||.15,this.minConfidence=b||.6,this.debugMode=c||!1}return d.prototype.analyze=function(c){var d=this,e=(new Date).getTime(),g={},h={},i=d.toOneElementItemSets(c),j=d.findItemSetsMinSupportSatisfied(i,c,d.minSupport,g),k=j,l=1;for(d.debugMode&&console.log("Before finding item sets: "+d.getTime(e)+" ms");0!=k.length;){h[l]=k;var m=k.map(function(a){return a.itemSet}),n=f.toFixedSizeJoinedSets(m,l+1);k=d.findItemSetsMinSupportSatisfied(n,c,d.minSupport,g),l+=1}d.debugMode&&console.log("After finding item sets: "+d.getTime(e)+" ms");var o=function(a,b,c){var d=b[a.toString()];return d?d/c.length:0},p=[],q=function(a){var b=!1;return p.forEach(function(c){b||(b=c.toString()===a.toString())}),b};d.debugMode&&console.log("Before calculating association rules: "+d.getTime(e)+" ms");var r=[];for(var s in h){var m=h[s].map(function(a){return a.itemSet});0===m.length||m[0].length<=1||m.forEach(function(b){f.toAllSubSets(b).forEach(function(e){var h=f.getDiffArray(b,e);if(h.length>0){var i=o(b,g,c),j=o(e,g,c),k=i/j;!isNaN(k)&&!q(e)&&k>=d.minConfidence&&(p.push(e),r.push(new a.AssociationRule(e,h,k)))}})})}d.debugMode&&console.log("After calculating association rules: "+d.getTime(e)+" ms");var t=new b(h,r);return d.debugMode&&(console.log("AnalysisResult: "+JSON.stringify(t)),console.log("Apriori.Algorithm's total spent time: "+d.getTime(e)+" ms")),t},d.prototype.toOneElementItemSets=function(a){var b=[];return a.forEach(function(a){a.forEach(function(a){b.push(new Array(a))})}),f.toArraySet(b)},d.prototype.findItemSetsMinSupportSatisfied=function(a,b,d,e){var g=[],h={};a.forEach(function(a){b.forEach(function(b){f.isSubSetArrayOf(a,b)&&(e[a.toString()]||(e[a.toString()]=0),h[a.toString()]||(h[a.toString()]=0),e[a.toString()]+=1,h[a.toString()]+=1)})});for(var i in h){var j=i.split(",").sort(),k=h[j.toString()],l=k/b.length;if(l>=d){var m=!1;g.forEach(function(a){m||(m=a.itemSet===j)}),m||g.push(new c(j,l))}}return g},d.prototype.showAnalysisResultFromFile=function(a){var b=this;require("fs").readFile(a,"utf8",function(a,c){if(a)throw a;var d=f.readCSVToArray(c,","),e=b.analyze(d);console.log(JSON.stringify(e.associationRules))})},d.prototype.getTime=function(a){return(new Date).getTime()-a},d}();a.Algorithm=e;var f=function(){function a(){}return a.toStringSet=function(a){var b=[];return a.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),b},a.toArraySet=function(a){var b={},c=[];return a.forEach(function(a){b.hasOwnProperty(a.toString())||(c.push(a),b[a.toString()]=!0)}),c},a.toAllSubSets=function(b){var c=function(b,d,e,f){if(0===b)e.length>0&&(f[f.length]=a.toStringSet(e));else for(var g=0;g<d.length;g++){var h=b-1,i=d.slice(g+1),j=e.concat([d[g]]);c(h,i,j,f)}},d=[];b.sort();for(var e=1;e<b.length;e++)c(e,b,[],d);return d.push(b),a.toArraySet(d)},a.toFixedSizeJoinedSets=function(b,c){var d=[];return b.forEach(function(e){b.forEach(function(b){if(a.getDiffArray(e,b).length>0){var f=[].concat(e).concat(b),g=a.toStringSet(f);g.length===c&&d.push(g)}})}),a.toArraySet(d)},a.isSubSetArrayOf=function(a,b){var c=!0;return a.forEach(function(a){c&&-1===b.indexOf(a)&&(c=!1)}),c},a.getDiffArray=function(a,b){var c=[];return a.forEach(function(a){-1===b.indexOf(a)&&c.push(a)}),c},a.readCSVToArray=function(a,b){b=b||",";for(var c,d=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),e=[[]];c=d.exec(a);){var f=c[1];f.length&&f!==b&&e.push([]);var g=c[2]?c[2].replace(new RegExp('""',"g"),'"'):c[3];g.length>0&&e[e.length-1].push(g)}return e},a}();a.ArrayUtils=f}(Apriori||(Apriori={}));var module=module||null;module&&module.exports&&(module.exports=Apriori);